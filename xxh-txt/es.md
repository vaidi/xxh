 es索引查询快的相关文章
 https://baijiahao.baidu.com/s?id=1682125327490741858&wfr=spider&for=pc
 1，倒排索引
 2，分布式系统
 3，文档分词
 4，优化查询功能
 5，数据结构和算法（字典树）
 6，缓存机制

缺点：
1，数据安全
2，不支持事务操作
3，准事实性

term index在内存中是fst的数据结构来保存的，优点
1，空间占用小，通过词典中的前缀和后缀的重复利用，压缩了存储空间
2，查询速度快，
 
 针对取交集，并且，与
 filter的查询用稀疏位图，不是filter的查询用跳表
 
 在es中filter查询，只处理文档是否匹配与否，不涉及评分操作，查询结果可以被缓存起来，
 对postings list的查询采用稀疏位图（压缩 高16位，抵16位）的方式，可以更好的进行求并集，交集，or
 
 
 es准实时的
 https://zhuanlan.zhihu.com/p/205211099?utm_source=ZHShareTargetIDMore&utm_id=0
 
 es解决深度分页问题.
 1,sroll api
 2，search after:
 
 es中fileType
 text 会进行分词
 keyword l类型表示字符串类型的字段，通常用于 精确匹配，聚合，排序，不被分词
 integer表示整数类型  支持long，integer，short，byte类型，它可用于数字范围查询和聚合查询
 
 
 
 查询：
 term 查询不分词,用于精确搜索
 match 和match_pharse,match 会进行分词
 
 lucene中的主要模块：
 analysis
 主要负责词法及语言处理，也就是我们常说的分词，通过该模块可最终形成存储或者搜索的最小单元term
 
 index主要负责索引的创建工作
 store 主要负责索引的读写，主要是对文件的一些操作，其主要的是抽象出和平台文件系统无关的存储
 queryParser 主要负责语法分析，把我们的查询语句生产lucene底层可以识别的条件
 search 主要搜索工作
 similarity 主要负责相关性打分和排序的实现
 
 
 es使用相关
 https://developer.volcengine.com/articles/7322138664606105626
 
 
 
 
 es的倒排索引？
 term index->term dictionary->posting list【docIdList】
 
 term 用fst保存
 dictionary词典表
 
 
 
 es 的query 和fetch
 query是确定取哪个doc。
 fetch是取出具体的doc。
 
 
 原理：
 内存缓冲：当一个写请求发送到Elasticsearch后，它首先将数据写入一个内存缓冲区（memory buffer）中。这个阶段的数据是无法被搜索到的。
 刷新操作：Elasticsearch会定期（默认为每秒一次）执行一个刷新（refresh）操作，该操作会将内存缓冲区中的数据写入到操作系统的文件系统缓存（File system cache）中，并清空内存缓冲区。这一操作使得之前写入的数据现在可以被搜索到。
 文件系统缓存：文件系统缓存是一个中间层，介于内存和硬盘之间。数据在写入硬盘之前会先进入这个缓存。写入文件系统缓存的数据可以被快速检索，但还不是永久性的。
 持久化存储：为了确保数据的持久性，Elasticsearch会定期（默认为每30分钟一次）将文件系统缓存中的数据写入到硬盘中。此外，为了确保数据的完整性和在发生故障时能够恢复，Elasticsearch还会使用事务日志（translog）来记录所有的写操作。
 
 
 
 Elasticsearch的查询过程大体上分为两个阶段：Query阶段和Fetch阶段。这两个阶段共同协作，使得Elasticsearch能够高效地处理搜索请求并返回结果。
 
 Query阶段
 Query阶段的主要任务是定位到包含所需数据的分片，并在这些分片上执行搜索查询。以下是Query阶段的详细流程：
 
 请求接收与转发：当一个搜索请求被发送到Elasticsearch集群时，它会首先被一个节点（通常是协调节点，coordinator node）接收。协调节点负责处理这个请求，并将它转发到包含所需数据的分片上。这个过程使用了数据路由算法，根据文档的ID或者用户指定的路由值来确定文档应该被存储在哪个分片上。
 分片搜索：每个分片在接收到查询请求后，会在本地执行搜索操作。这包括使用倒排索引来查找与查询条件匹配的文档，并根据相关性得分对结果进行排序。每个分片都会构建一个本地优先级队列（priority queue），其中包含了一定数量的最相关的文档（默认为10个，但这个数值可以根据分页操作进行调整）。
 结果合并：协调节点在接收到所有分片的搜索结果后，会将这些结果合并成一个全局的排序后的结果集。合并过程中，协调节点会根据每个文档的相关性得分和其他排序标准（如时间戳、地理位置等）对结果进行排序。
 Fetch阶段
 Fetch阶段的主要任务是从Query阶段确定的分片中检索完整的文档数据，并将这些数据返回给客户端。以下是Fetch阶段的详细流程：
 
 排序与裁剪：在Fetch阶段开始之前，协调节点会对合并后的结果集进行最终的排序和裁剪操作。排序是根据文档的相关性得分和其他排序标准进行的，而裁剪则是为了限制返回给客户端的结果数量。
 数据检索：一旦排序和裁剪完成，协调节点会向包含所需文档的分片发起Fetch请求。这些请求会指定需要检索的文档ID和需要返回的字段信息。每个分片在接收到Fetch请求后，会查找对应的文档数据，并将其返回给协调节点。
 结果返回：协调节点在收到所有分片返回的数据后，会将它们组合成一个完整的搜索结果集，并返回给客户端。这个结果集包含了所有符合条件的文档数据以及相关的元信息（如相关性得分、文档来源等）。
 通过Query和Fetch两个阶段的协作，Elasticsearch能够高效地处理搜索请求并返回准确的结果。Query阶段负责定位到包含所需数据的分片并执行搜索查询，而Fetch阶段则负责从这些分片中检索完整的文档数据并返回给客户端。这种分阶段的处理方式使得Elasticsearch能够在处理大量数据和复杂查询时保持高性能和可扩展性。